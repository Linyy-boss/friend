<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>和 Sleep Beast 打個招呼 💤</title>
  <style>
    :root{
      --almond:#F5E8DC;
      --rose:#A37070;
      --ink:#3d3434;
      --muted:#7b6f6f;
      --shadow:0 10px 30px rgba(163,112,112,.18);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(160deg, var(--almond) 0%, #fff 60%);
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Microsoft JhengHei","PingFang TC", sans-serif;
      display:flex;align-items:center;justify-content:center;padding:24px;
    }
    .phone{width:min(420px,100%);background:#fff;border-radius:28px;border:2px solid var(--rose);
      box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;}
    .topbar{background:var(--rose);color:#fff;padding:14px 16px;display:flex;align-items:center;gap:10px;}
    .title{font-weight:700}
    .subtitle{font-size:12px;opacity:.85}
    .chat{background:#fff;display:flex;flex-direction:column;height:68vh;min-height:520px}
    .msgs{flex:1;overflow:auto;padding:16px;background:var(--almond)}
    .row{display:flex;align-items:flex-end;margin:8px 0;gap:8px}
    .row.me{justify-content:flex-end}
    .avatar{width:34px;height:34px;border-radius:999px;background:#fff;border:2px solid var(--rose);
      display:flex;align-items:center;justify-content:center;overflow:hidden}
    .bubble{max-width:70%;padding:10px 12px;border-radius:18px;line-height:1.45;box-shadow:0 2px 0 rgba(0,0,0,.06)}
    .bubble.bot{background:#fff;border:1px solid var(--rose)}
    .bubble.me{background:var(--rose);color:#fff}
    .sys{display:flex;justify-content:center;margin:10px 0}
    .sys span{font-size:12px;color:var(--muted);background:#ffffffaa;border:1px dashed var(--rose);padding:4px 10px;border-radius:999px}
    .input{display:flex;gap:10px;padding:12px;border-top:2px solid var(--rose);background:#fff}
    textarea{flex:1;resize:none;min-height:42px;max-height:120px;padding:10px 12px;border-radius:16px;border:1px solid var(--rose);background:#fff;color:var(--ink)}
    button{border:none;padding:10px 16px;border-radius:14px;font-weight:700;cursor:pointer;background:var(--rose);color:#fff}
    button:disabled{opacity:.6;cursor:not-allowed}
    .footer-note{padding:8px 16px;color:var(--muted);font-size:12px}
    a{color:var(--rose);text-decoration:none}
  </style>
</head>
<body>
  <div class="phone" role="application" aria-label="Sleep Beast 留言視窗">
    <div class="topbar">
      <div>
        <div class="title">Sleep Beast 的小信箱</div>
        <div class="subtitle">打聲招呼吧～我會回你一個可愛的打呼</div>
      </div>
    </div>
    <div class="chat">
      <div id="msgs" class="msgs" aria-live="polite"></div>
      <div class="footer-note">＊留言只會私下送到我的收件服務，不公開顯示。<a href="#" id="privacy">隱私說明</a></div>
      <form id="form" class="input">
        <textarea id="text" placeholder="想說什麼都可以～" required></textarea>
        <button id="send" type="submit">送出</button>
      </form>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = "https://linyy.app.n8n.cloud/webhook-test/friends";
    const SHARED_KEY = "my-expo-2025";
    const EXHIBITION_NAME = "BoothA-2025";

    const msgs = document.getElementById('msgs');
    const form = document.getElementById('form');
    const text = document.getElementById('text');
    const sendBtn = document.getElementById('send');

    function addRow(role, content){
      const row = document.createElement('div');
      row.className = 'row ' + (role==='user'?'me':'bot');
      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      if(role==='bot') avatar.innerHTML = '🐻‍❄️'; else avatar.textContent = '你';
      const b = document.createElement('div');
      b.className = 'bubble ' + (role==='user'?'me':'bot');
      b.textContent = content;
      if(role==='bot') row.appendChild(avatar);
      row.appendChild(b);
      if(role==='user') row.appendChild(avatar);
      msgs.appendChild(row);
      msgs.scrollTop = msgs.scrollHeight;
    }

    async function sendToBackend(message){
      const payload = { key: SHARED_KEY, source: EXHIBITION_NAME, message, ts: Date.now() };
      const res = await fetch(WEBHOOK_URL,{
        method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('deliver failed '+res.status);
      return await res.json().catch(()=>({ok:true}));
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const value = text.value.trim();
      if(!value) return;
      addRow('user', value);
      text.value='';
      sendBtn.disabled = true;
      try{
        await sendToBackend(value);
        // 成功後提醒使用者需要重新整理來清空
        addRow('bot','✅ 已送達！請重新整理頁面開始新的留言。');
      }catch(err){
        addRow('bot','⚠️ 網路不穩，稍後再試。');
      }finally{
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
